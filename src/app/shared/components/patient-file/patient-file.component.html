<div class="card rectangle-custom">
    <div class="card-body custom-card-message">
        <mat-tab-group mat-align-tabs="start" [backgroundColor]="'primary'">
            <mat-tab label="Informations">
                <ng-template mat-tab-label id="info-tab">
                    <i class="fas fa-info my-tab-icon pr-custom-11px"></i>
                    <span> {{labels.info}}</span>
                </ng-template>
                <!-- Patient File information -->
                <div class="card-body">
                    <form [formGroup]="personalInfoForm">
                        <div class="row">
                            <div class="col-12 col-sm-3">
                                <!-- civility Field -->
                                <label for="civility"
                                    class="col-12 col-sm-12 col-form-label">{{ labels.civility }}</label>
                                <div class="col-12 col-sm-12">
                                    <select (change)="changeMaidenName()" formControlName="civility" id="civility"
                                        class="form-control" [ngClass]="{
                      'is-invalid': submitted && ctr.civility.errors
                    }">
                                        <option value="null" disabled="true" [selected]="true">{{ labels.civility }}
                                        </option>
                                        <option value="M">M</option>
                                        <option value="MME">Mme</option>
                                        <option value="CHILD">Enfant</option>
                                    </select>
                                    <div *ngIf="submitted && ctr.civility.errors" class="invalid-feedback">
                                        <div *ngIf="ctr.civility.errors.required">
                                            {{ errors.required }}
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-12 col-sm-4">
                                <!-- last name Field -->
                                <label for="last_name"
                                    class="col-12 col-sm-12 col-form-label">{{ labels.last_name }}</label>
                                <div class="col-12 col-sm-12">
                                    <input type="text" formControlName="lastName" id="last-name"
                                        [ngClass]="{ 'is-invalid': submitted && ctr.lastName.errors }"
                                        class="form-control" id="lastName" />
                                    <div *ngIf="submitted && ctr.lastName.errors" class="invalid-feedback">
                                        <div *ngIf="ctr.lastName.errors.required">
                                            {{ errors.required }}
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-12 col-sm-5">
                                <!-- first name Field -->
                                <label for="firstName"
                                    class="col-12 col-sm-12  col-form-label">{{ labels.first_name }}</label>
                                <div class="col-12 col-sm-12">
                                    <input [ngClass]="{
                      'is-invalid': submitted && ctr.firstName.errors
                    }" type="text" formControlName="firstName" class="form-control" id="first-name" />
                                    <div *ngIf="submitted && ctr.firstName.errors" class="invalid-feedback">
                                        <div *ngIf="ctr.firstName.errors.required">
                                            {{ errors.required }}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <br>
                        <!-- maidenName  Field -->
                        <div class="row" *ngIf="displayMaidenName">
                            <div class="col">
                                <label for="maidenName"
                                    class="col-12 col-sm-12 col-md-12 col-lg-12 col-xl-12 col-form-label">{{ labels.maiden_name }}</label>
                                <div class="col-12">
                                    <input type="text" formControlName="maidenName" class="form-control"
                                        id="maidenName" />
                                </div>
                            </div>
                        </div>
                        <br *ngIf="displayMaidenName">
                        <div class="row">
                            <div class="col-12 col-sm-5">
                                <label for="birthday"
                                    class="col-12 col-sm-12 col-md-12 col-lg-12 col-xl-12 col-form-label">{{ labels.birthday }}</label>
                                <div class="col-12">
                                    <input type="text" formControlName="birthday" class="form-control"
                                        placeholder="{{ labels.birth_date }}" bsDatepicker [maxDate]="maxDatecheck()"
                                        [placement]="placement" [bsConfig]="{ containerClass: 'theme-dark-blue' }"
                                        [ngClass]="{ 'is-invalid': submitted && ctr.birthday.errors }" />
                                    <div *ngIf="submitted && ctr.birthday.errors" class="invalid-feedback">
                                        <div *ngIf="ctr.birthday.errors.required">
                                            {{ errors.required }}
                                        </div>
                                    </div>
                                    <div *ngIf="isFutureDate" class="invalid-feedback">
                                        <div>
                                            {{ errors.futureDate }}
                                        </div>
                                    </div>
                                </div>

                            </div>
                            <!-- Email Field -->
                            <div class="col-12 col-sm-7">
                                <label for="email"
                                    class="col-12 col-sm-12 col-md-12 col-lg-12 col-xl-12 col-form-label">{{ labels._email_address }}
                                    (*)</label>
                                <div class="col-12">
                                    <input type="text" formControlName="email" class="form-control" id="email"
                                        [ngClass]="{ 'is-invalid': submitted && personalInfoForm.errors }" />
                                    <div *ngIf="personalInfoForm.errors?.requiredValidator" class="invalid-feedback">
                                        {{ errors.required }}
                                    </div>
                                    <div *ngIf="submitted && ctr.email.errors" class="invalid-feedback">
                                        <div *ngIf="ctr.email.errors.email">
                                            {{ errors.email_invalid_format }}
                                        </div>
                                    </div>
                                </div>
                            </div>

                        </div>
                        <br>
                        <!-- Phone number -->
                        <div class="row">
                            <div class="col col-12">
                                <div class="col-12 col-form-label">{{ labels.phone }}</div>
                                <div class="col-12 row">
                                    <div class="col-10 col-sm-11">
                                        <international-phone-number *ngIf="!isAdd" class="form-control" id="phoneNumber"
                                            formControlName="phoneNumber" placeholder="Téléphone ou fixe *"
                                            [maxlength]="20" name="phoneNumber" [defaultCountry]=" '' " [ngClass]="{
                                          'is-invalid': submitted && personalInfoForm.errors
                                        }">
                                        </international-phone-number>
                                        <international-phone-number *ngIf="isAdd" class="form-control" id="phoneNumber"
                                            formControlName="phoneNumber" placeholder="Téléphone ou fixe *"
                                            [maxlength]="20" name="phoneNumber" [defaultCountry]="'fr'" [ngClass]="{
                                        'is-invalid': submitted && personalInfoForm.errors
                                      }">
                                        </international-phone-number>
                                        <div *ngIf="personalInfoForm.errors?.requiredValidator"
                                            class="invalid-feedback">
                                            {{ errors.required }}
                                        </div>
                                        <div *ngIf="ctr.phoneNumber.invalid && ctr.phoneNumber.touched"
                                            class="invalid-feedback">
                                            {{ errors.invalid_phone }}
                                        </div>
                                    </div>
                                    <div class="col-1 col-sm-1">
                                        <button (click)="addPhone()" class="btn btn-xs btn-icon" id="add-phone-button">
                                            <i class="far fa-plus"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <br>
                        <div class="row">
                            <div class="col col-12">
                                <!-- Other Phones -->
                                <div *ngIf="isLabelShow" class="col-12 col-form-label">
                                    {{ labels.other_phone }}
                                </div>
                                <div class="col-12 col-sm-12">
                                    <int-phone [editList]="otherPhones" (phones)="getPhoneList($event)"
                                        [addnewPhone]="addnewPhone" (validPhones)="submitPhones($event)"
                                        id="other-phones">
                                    </int-phone>
                                </div>
                            </div>
                        </div>
                        <br *ngIf="isLabelShow" />
                        <!-- address Field -->
                        <div class=" row">
                            <div class="col">
                                <label for="address"
                                    class="col-12 col-sm-12 col-md-12 col-lg-12 col-xl-12 col-form-label">{{ labels._address }}</label>
                                <div class="col-12">
                                    <input type="text" formControlName="address" class="form-control" id="address" />
                                </div>
                            </div>

                        </div>
                        <br>
                        <!-- additional address Field -->
                        <div class=" row">
                            <div class="col">
                                <label for="additionalAddress"
                                    class="col-12 col-sm-12 col-md-12 col-lg-12 col-xl-12 col-form-label">{{ labels.additional_address }}</label>
                                <div class="col-12 col-sm-12">
                                    <input type="text" formControlName="additionalAddress" class="form-control"
                                        id="additionalAddress" />
                                </div>
                            </div>
                        </div>
                        <br>
                        <div class="row">
                            <div class="col-12 col-sm-5">
                                <!-- zipcode Field -->
                                <label for="zipCode"
                                    class="col-12 col-sm-12 col-md-12 col-lg-12 col-xl-12 col-form-label">{{ labels._zip_code }}</label>
                                <div class="col-12">
                                    <input type="text" formControlName="zipCode" class="form-control" id="zipCode" />
                                </div>
                            </div>
                            <div class="col-12 col-sm-7">
                                <!-- city Field -->
                                <label for="city"
                                    class="col-12 col-sm-12 col-md-12 col-lg-12 col-xl-12 col-form-label">{{ labels._city }}</label>
                                <div class="col-12">
                                    <input type="text" formControlName="city" class="form-control" id="city" />
                                </div>
                            </div>
                        </div>
                        <br>
                        <div>

                        </div>
                        <div *ngIf="displayInvite " class="row send-invitation">
                            <label for="invitationStatus" class=" invitation-text  ">
                                <input type="checkbox" formControlName="invitationStatus"
                                    (change)="onCheckboxChange($event)" />&nbsp;&nbsp;
                                {{ labels.send_invitation }}</label>
                            <br>
                        </div>
                        <div class="row justify-content-center">
                            <button type="submit" class="btn btn-primary mr-3" id="submit-info-button"
                                (click)="patientSubmit()">{{ labels.save }}
                            </button>
                            <button (click)="cancelActionClicked()" class="btn btn-cancel" id="cancel-button">
                                {{ labels.cancel }}
                            </button>
                        </div>
                    </form>
                </div>
            </mat-tab>
            <!-- Notes -->
            <mat-tab label="Notes" *ngIf="!isAdd">
                <ng-template mat-tab-label>
                    <i class="fas fa-notes-medical my-tab-icon pr-custom-11px"></i>
                    <span>{{labels.notes}}</span>
                </ng-template>
                <div class="card-body">
                    <div class="row add-note">
                        <button class="btn btn-success" (click)="addNote()">
                            <i class="far fa-plus"></i>&nbsp;&nbsp;{{ labels.add_note }}
                        </button>
                    </div>
                    <br>
                    <div *ngIf="!isnoteList" class="card-body-note">
                        <form [formGroup]="noteForm">
                            <br>
                            <div class="row">
                                <div class="col-7">
                                    <label for="date" class="col-12 col-form-label">{{ labels.note_date }}</label>
                                    <div class="col-12 input-icons">
                                        <i class="fa fa-calendar icon"></i>
                                        <input type="text" formControlName="date" class="calender form-control"
                                            bsDatepicker [bsConfig]="{
                                              containerClass: 'theme-dark-blue',
                                              dateInputFormat: 'DD/MM/YYYY'
                                            }" [ngClass]="{
                                              'is-invalid': noteSubmitted && f.date.errors
                                            }" />
                                        <div *ngIf="noteSubmitted && f.date.errors" class="invalid-feedback">
                                            <div *ngIf="f.date.errors.required">
                                                {{ errors.required }}
                                            </div>
                                        </div>
                                    </div>
                                </div>

                            </div>
                            <div class="row">
                                <div class="col-12 ">
                                    <!-- Note Field -->
                                    <label for="value" class="col-12 col-form-label">{{ labels.note_value }}</label>
                                    <div class="col-12">
                                        <textarea type="text" formControlName="value" class="form-control" [ngClass]="{
                                          'is-invalid': noteSubmitted && f.value.errors
                                        }">
                                      </textarea>
                                        <div *ngIf="noteSubmitted && f.value.errors" class="invalid-feedback">
                                            <div *ngIf="f.value.errors.required">
                                                {{ errors.required }}
                                            </div>

                                        </div>
                                    </div>
                                </div>
                            </div>
                            <br>
                            <div class="row justify-content-center actions">
                                <button (click)="NoteSubmit()" type="submit" class="btn btn-primary mr-3">
                                    {{ labels.save }}
                                </button>
                                <button (click)="cancelNoteAdd()" class="btn btn-cancel">
                                    {{ labels.cancel }}
                                </button>
                            </div>
                            <br>
                        </form>
                    </div>
                    <br *ngIf="!isnoteList">
                    <lib-hls-generic-list [imageSource]="noteimageSource" [isCheckbox]="false" [list]="noteList"
                        (archieveAction)="archieveNote($event)" (cardAction)="noteCardClicked($event)">
                    </lib-hls-generic-list>
                </div>
            </mat-tab>
            <!-- History -->
            <mat-tab label="Historique" *ngIf="!isAdd">
                <ng-template mat-tab-label>
                    <i class="fas fa-history my-tab-icon pr-custom-11px"></i>
                    {{labels.history}}
                </ng-template>
                <div class="card-body">
                    <lib-hlsMessagingList [list]=" filtredItemList" [hasPaging]="true"
                        (cardAction)="messageClicked($event)" [imageSource]="imageSource" [hasPaging]="true">
                    </lib-hlsMessagingList>
                    <div class="search-results" infiniteScroll [infiniteScrollDistance]="2"
                        [infiniteScrollThrottle]="50" (scrolled)="onScroll()"></div>
                    <mat-progress-spinner *ngIf="scroll" diameter="20" mode="indeterminate" value="100">
                    </mat-progress-spinner>
                </div>
            </mat-tab>
        </mat-tab-group>
    </div>
</div>